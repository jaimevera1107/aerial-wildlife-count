{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ”§ InstalaciÃ³n de Dependencias\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ“¦ Importar LibrerÃ­as\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ“ ConfiguraciÃ³n de Datos\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "73fe8acf",
   "metadata": {},
   "source": [
    "## ğŸ”¥ Funciones de Backup AutomÃ¡tico en Drive\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4b1ac9e9",
   "metadata": {},
   "source": [
    "## ğŸ“Š Monitoreo en Tiempo Real\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d4cf30ee",
   "metadata": {},
   "source": [
    "## ğŸš€ InicializaciÃ³n del Sistema de Backup\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ“Š Cargar y Preparar Datos\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ—ï¸ ConfiguraciÃ³n del Modelo\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3dbb932b",
   "metadata": {},
   "source": [
    "## ğŸ›‘ Early Stopping Implementado\n",
    "\n",
    "### âœ… **ConfiguraciÃ³n Agregada**\n",
    "- **Patience**: 5 Ã©pocas (configurable en `CascadeConfig`)\n",
    "- **MÃ©trica monitoreada**: `coco/bbox_mAP` (mean Average Precision)\n",
    "- **Modo**: `max` (busca maximizar la mÃ©trica)\n",
    "- **Delta mÃ­nimo**: 0.001 (mejora mÃ­nima requerida)\n",
    "\n",
    "### ğŸ¯ **Â¿CÃ³mo funciona?**\n",
    "- El entrenamiento se detendrÃ¡ automÃ¡ticamente si la mÃ©trica `coco/bbox_mAP` no mejora durante **5 Ã©pocas consecutivas**\n",
    "- Esto evita el sobreajuste y ahorra tiempo de entrenamiento\n",
    "- El modelo se guardarÃ¡ automÃ¡ticamente cuando se active el early stopping\n",
    "\n",
    "### âš™ï¸ **PersonalizaciÃ³n**\n",
    "Para cambiar el comportamiento, modifica en la clase `CascadeConfig`:\n",
    "```python\n",
    "self.patience = 10  # MÃ¡s paciencia (10 Ã©pocas)\n",
    "self.patience = 3   # Menos paciencia (3 Ã©pocas)\n",
    "```\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸš€ Entrenamiento del Modelo\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ“Š EvaluaciÃ³n y VisualizaciÃ³n\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6ba5baf5",
   "metadata": {},
   "source": [
    "## ğŸ“Š CÃ¡lculo de MÃ©tricas de ClasificaciÃ³n\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "79356e2c",
   "metadata": {},
   "source": [
    "## ğŸš€ Instrucciones de Uso - V1 Optimizado\n",
    "\n",
    "### ğŸ“‹ **Antes de Ejecutar:**\n",
    "1. **Montar Google Drive** (se hace automÃ¡ticamente)\n",
    "2. **Verificar que tienes Colab Pro/Pro+** para mejor rendimiento\n",
    "3. **Configurar datos** en la estructura correcta\n",
    "\n",
    "### ğŸ”¥ **CaracterÃ­sticas V1:**\n",
    "- **Backup automÃ¡tico**: Los checkpoints se guardan en Drive cada 5 Ã©pocas\n",
    "- **RecuperaciÃ³n automÃ¡tica**: Si se interrumpe, reanuda desde el Ãºltimo checkpoint\n",
    "- **ConfiguraciÃ³n optimizada**: Batch size 8, workers 8 para mayor velocidad\n",
    "- **Monitoreo en tiempo real**: Usa `show_training_status()` para ver progreso\n",
    "\n",
    "### ğŸ“Š **Comandos Ãštiles Durante el Entrenamiento:**\n",
    "```python\n",
    "# Ver estado del entrenamiento\n",
    "show_training_status()\n",
    "\n",
    "# Hacer backup manual\n",
    "backup_to_drive()\n",
    "\n",
    "# Verificar backups en Drive\n",
    "monitor_training_progress()\n",
    "```\n",
    "\n",
    "### âš ï¸ **Importante:**\n",
    "- **NO cierres la pestaÃ±a** de Colab durante el entrenamiento\n",
    "- **Los backups se hacen automÃ¡ticamente** cada 5 Ã©pocas\n",
    "- **Si se interrumpe**, simplemente ejecuta de nuevo y reanudarÃ¡ automÃ¡ticamente\n",
    "- **Los checkpoints se guardan en**: `/content/drive/MyDrive/aerial-wildlife-count-results/cascade_rcnn_v1/`\n",
    "\n",
    "### ğŸ¯ **Optimizaciones de Velocidad:**\n",
    "- **Batch size**: 8 (vs 4 original)\n",
    "- **Val batch size**: 4 (vs 2 original)\n",
    "- **Workers**: 8 (vs 4 original)\n",
    "- **Save period**: 1 Ã©poca (vs 10 original)\n",
    "- **Early stopping**: 5 Ã©pocas de paciencia\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ‰ Â¡Entrenamiento Completado!\n",
    "\n",
    "### ğŸ“‹ Resumen del Entrenamiento\n",
    "- **Modelo**: Cascade R-CNN con backbone {cascade_config.backbone}\n",
    "- **TamaÃ±o de imagen**: {cascade_config.imgsz}x{cascade_config.imgsz}\n",
    "- **Ã‰pocas**: {cascade_config.epochs}\n",
    "- **Early Stopping**: {cascade_config.patience} Ã©pocas de paciencia\n",
    "- **Clases detectadas**: {len(cascade_config.classes)} especies de animales\n",
    "\n",
    "### ğŸ“Š PrÃ³ximos Pasos\n",
    "1. **Evaluar mÃ©tricas**: Revisar mAP, precision, recall\n",
    "2. **Ajustar hiperparÃ¡metros**: Si es necesario mejorar el rendimiento\n",
    "3. **Exportar modelo**: Convertir a ONNX o TorchScript para deployment\n",
    "4. **Probar en nuevas imÃ¡genes**: Validar en datos no vistos\n",
    "\n",
    "### ğŸ”§ ConfiguraciÃ³n Personalizada\n",
    "Para modificar parÃ¡metros, edita la clase `CascadeConfig` en la celda de configuraciÃ³n:\n",
    "- Cambiar backbone: `\"swin_t\"` o `\"resnext\"`\n",
    "- Ajustar Ã©pocas: `epochs = 100`\n",
    "- Modificar tamaÃ±o de imagen: `imgsz = 1024`\n",
    "- Cambiar batch size: `batch_size = 8`\n",
    "- Ajustar early stopping: `patience = 10` (mÃ¡s paciencia) o `patience = 3` (menos paciencia)\n",
    "\n",
    "### ğŸ“š Recursos Adicionales\n",
    "- [DocumentaciÃ³n MMDetection](https://mmdetection.readthedocs.io/)\n",
    "- [Cascade R-CNN Paper](https://arxiv.org/abs/1712.00726)\n",
    "- [Swin Transformer Paper](https://arxiv.org/abs/2103.14030)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## ğŸ’¾ Guardar y Descargar Resultados\n"
   ]
  }
 ],
 "metadata": {
  "language_info": {
   "name": "python"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}